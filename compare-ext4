#!/bin/bash

EXT4_EXPRESSIONS=(
write_bw

# perf list | grep ext4: | awk '{print $1}'
ext4:ext4_free_inode
ext4:ext4_request_inode
ext4:ext4_allocate_inode
ext4:ext4_evict_inode
ext4:ext4_drop_inode
ext4:ext4_mark_inode_dirty
ext4:ext4_begin_ordered_truncate
ext4:ext4_write_begin
ext4:ext4_da_write_begin
ext4:ext4_ordered_write_end
ext4:ext4_writeback_write_end
ext4:ext4_journalled_write_end
ext4:ext4_da_write_end
ext4:ext4_da_writepages
ext4:ext4_da_write_pages
ext4:ext4_da_writepages_result
ext4:ext4_writepage
ext4:ext4_readpage
ext4:ext4_releasepage
ext4:ext4_invalidatepage
ext4:ext4_discard_blocks
ext4:ext4_mb_new_inode_pa
ext4:ext4_mb_new_group_pa
ext4:ext4_mb_release_inode_pa
ext4:ext4_mb_release_group_pa
ext4:ext4_discard_preallocations
ext4:ext4_mb_discard_preallocations
ext4:ext4_request_blocks
ext4:ext4_allocate_blocks
ext4:ext4_free_blocks
ext4:ext4_sync_file_enter
ext4:ext4_sync_file_exit
ext4:ext4_sync_fs
ext4:ext4_alloc_da_blocks
ext4:ext4_mballoc_alloc
ext4:ext4_mballoc_prealloc
ext4:ext4_mballoc_discard
ext4:ext4_mballoc_free
ext4:ext4_forget
ext4:ext4_da_update_reserve_space
ext4:ext4_da_reserve_space
ext4:ext4_da_release_space
ext4:ext4_mb_bitmap_load
ext4:ext4_mb_buddy_bitmap_load
ext4:ext4_read_block_bitmap_load
ext4:ext4_load_inode_bitmap
ext4:ext4_direct_IO_enter
ext4:ext4_direct_IO_exit
ext4:ext4_fallocate_enter
ext4:ext4_fallocate_exit
ext4:ext4_unlink_enter
ext4:ext4_unlink_exit
ext4:ext4_truncate_enter
ext4:ext4_truncate_exit
ext4:ext4_ext_convert_to_initialized_enter
ext4:ext4_ext_convert_to_initialized_fastpath
ext4:ext4_ext_map_blocks_enter
ext4:ext4_ind_map_blocks_enter
ext4:ext4_ext_map_blocks_exit
ext4:ext4_ind_map_blocks_exit
ext4:ext4_ext_load_extent
ext4:ext4_load_inode
ext4:ext4_journal_start
ext4:ext4_trim_extent
ext4:ext4_trim_all_free
ext4:ext4_ext_handle_uninitialized_extents
ext4:ext4_get_implied_cluster_alloc_exit
ext4:ext4_ext_put_in_cache
ext4:ext4_ext_in_cache
ext4:ext4_find_delalloc_range
ext4:ext4_get_reserved_cluster_alloc
ext4:ext4_ext_show_extent
ext4:ext4_remove_blocks
ext4:ext4_ext_rm_leaf
ext4:ext4_ext_rm_idx
ext4:ext4_ext_remove_space
ext4:ext4_ext_remove_space_done

# perf list | grep jbd2: | awk '{print $1}'
jbd2:jbd2_checkpoint
jbd2:jbd2_start_commit
jbd2:jbd2_commit_locking
jbd2:jbd2_commit_flushing
jbd2:jbd2_commit_logging
jbd2:jbd2_end_commit
jbd2:jbd2_submit_inode_data
jbd2:jbd2_run_stats
jbd2:jbd2_checkpoint_stats
jbd2:jbd2_cleanup_journal_tail

)

for e in ${EXT4_EXPRESSIONS[*]}
do
	./compare -g ext4 -e $e "$@"
	echo
done
